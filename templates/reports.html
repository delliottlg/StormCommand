{% extends "base.html" %}

{% block title %}Reports - StormCommand{% endblock %}

{% block content %}
<section class="section">
    <div class="container">
        <h1 class="title is-2">
            <i class="fas fa-chart-bar"></i> Reports & Analytics
        </h1>

        <div class="columns">
            <div class="column is-6">
                <div class="box">
                    <h3 class="title is-4">Leads by City</h3>
                    <table class="table is-fullwidth is-striped">
                        <thead>
                            <tr>
                                <th>City</th>
                                <th>Total Leads</th>
                                <th>Progress</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% if by_city %}
                            {% for city, count in by_city %}
                            <tr>
                                <td>{{ city }}</td>
                                <td>{{ count }}</td>
                                <td>
                                    <progress class="progress is-primary" value="{{ count }}" max="100">{{ count }}%</progress>
                                </td>
                            </tr>
                            {% endfor %}
                            {% else %}
                            <tr>
                                <td colspan="3" class="has-text-centered">No data available yet</td>
                            </tr>
                            {% endif %}
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="column is-6">
                <div class="box">
                    <h3 class="title is-4">Leads by Category</h3>
                    <table class="table is-fullwidth is-striped">
                        <thead>
                            <tr>
                                <th>Category</th>
                                <th>Total Leads</th>
                                <th>Progress</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% if by_category %}
                            {% for category, count in by_category %}
                            <tr>
                                <td>{{ category }}</td>
                                <td>{{ count }}</td>
                                <td>
                                    <progress class="progress is-info" value="{{ count }}" max="100">{{ count }}%</progress>
                                </td>
                            </tr>
                            {% endfor %}
                            {% else %}
                            <tr>
                                <td colspan="3" class="has-text-centered">No data available yet</td>
                            </tr>
                            {% endif %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="box">
            <h3 class="title is-4">Duplicate Detection Report</h3>
            {% if duplicates %}
            <div class="notification is-warning">
                <p><strong>Warning:</strong> The following companies appear multiple times in the database:</p>
            </div>
            <table class="table is-fullwidth">
                <thead>
                    <tr>
                        <th>Company Name</th>
                        <th>Occurrences</th>
                    </tr>
                </thead>
                <tbody>
                    {% for company, count in duplicates %}
                    <tr>
                        <td>{{ company }}</td>
                        <td>
                            <span class="tag is-danger">{{ count }} times</span>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <div class="notification is-success">
                <p><i class="fas fa-check-circle"></i> No duplicates detected in the database.</p>
            </div>
            {% endif %}
        </div>

        <div class="box">
            <div class="level">
                <div class="level-left">
                    <div class="level-item">
                        <div>
                            <p class="heading" style="color: var(--gs-cyan);">Export Options</p>
                            <p class="title is-5">Download all lead data</p>
                        </div>
                    </div>
                </div>
                <div class="level-right">
                    <div class="level-item">
                        <a href="/export-csv" class="button is-primary is-large">
                            <span class="icon">
                                <i class="fas fa-file-csv"></i>
                            </span>
                            <span>Export as CSV</span>
                        </a>
                    </div>
                </div>
            </div>
        </div>

    </div>
</section>
{% endblock %}