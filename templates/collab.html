{% extends "base.html" %}

{% block title %}Collaboration Hub - StormCommand{% endblock %}

{% block content %}
<section class="section">
    <div class="container">
        <div class="columns is-centered">
            <div class="column is-10">
                <h1 class="title is-2">
                    <i class="fas fa-users" style="color: var(--gs-cyan);"></i> Collaboration Hub
                </h1>
                <p class="subtitle">Share ideas, report issues, suggest target clients</p>

                <div class="columns mt-5">
                    <div class="column is-6">
                        <div class="box">
                            <h3 class="title is-4">
                                <i class="fas fa-lightbulb" style="color: var(--gs-cyan);"></i> Submit Ideas
                            </h3>
                            <form id="ideaForm">
                                <div class="field">
                                    <label class="label">Your Name</label>
                                    <div class="control">
                                        <input class="input" type="text" id="name" placeholder="Lance" required>
                                    </div>
                                </div>

                                <div class="field">
                                    <label class="label">Idea Type</label>
                                    <div class="control">
                                        <div class="select is-fullwidth">
                                            <select id="ideaType" required>
                                                <option value="">Select type...</option>
                                                <option value="client">New Client/Industry Target</option>
                                                <option value="feature">App Feature Request</option>
                                                <option value="strategy">Outreach Strategy</option>
                                                <option value="bug">Bug Report</option>
                                                <option value="other">Other</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>

                                <div class="field">
                                    <label class="label">Description</label>
                                    <div class="control">
                                        <textarea class="textarea" id="description" rows="6" placeholder="Describe your idea, client suggestion, or issue..." required></textarea>
                                    </div>
                                </div>

                                <div class="field">
                                    <label class="label">Priority</label>
                                    <div class="control">
                                        <label class="radio">
                                            <input type="radio" name="priority" value="low">
                                            <span style="color: #999;">Low - Nice to have</span>
                                        </label><br>
                                        <label class="radio">
                                            <input type="radio" name="priority" value="medium" checked>
                                            <span style="color: var(--gs-cyan);">Medium - Should consider</span>
                                        </label><br>
                                        <label class="radio">
                                            <input type="radio" name="priority" value="high">
                                            <span style="color: #ff9800;">High - Act soon</span>
                                        </label><br>
                                        <label class="radio">
                                            <input type="radio" name="priority" value="urgent">
                                            <span style="color: #f44336;">Urgent - Drop everything</span>
                                        </label>
                                    </div>
                                </div>

                                <div class="field">
                                    <div class="control">
                                        <button type="submit" class="button is-primary is-fullwidth">
                                            <span class="icon">
                                                <i class="fas fa-paper-plane"></i>
                                            </span>
                                            <span>Submit</span>
                                        </button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>

                    <div class="column is-6">
                        <div class="box" style="background: rgba(0, 156, 195, 0.05);">
                            <h3 class="title is-4">
                                <i class="fas fa-bullseye" style="color: var(--gs-cyan);"></i> Quick Ideas
                            </h3>
                            <div class="content">
                                <h5>Potential Client Categories to Target:</h5>
                                <div class="tags">
                                    <span class="tag is-info">Beachfront Condos</span>
                                    <span class="tag is-info">Coastal Universities</span>
                                    <span class="tag is-info">Marina Offices</span>
                                    <span class="tag is-info">Resort Chains</span>
                                    <span class="tag is-info">Historic Hotels</span>
                                    <span class="tag is-info">Government Buildings</span>
                                    <span class="tag is-info">Hospital Systems</span>
                                </div>

                                <h5 class="mt-4">High-Value Cities to Consider:</h5>
                                <div class="tags">
                                    <span class="tag is-warning">Miami Beach</span>
                                    <span class="tag is-warning">Galveston</span>
                                    <span class="tag is-warning">Virginia Beach</span>
                                    <span class="tag is-warning">Hilton Head</span>
                                    <span class="tag is-warning">Key West</span>
                                    <span class="tag is-warning">Corpus Christi</span>
                                </div>

                                <h5 class="mt-4">Recent Hurricane Zones (Hot Leads):</h5>
                                <ul>
                                    <li>Fort Myers (Hurricane Ian - 2022)</li>
                                    <li>Lake Charles (Hurricane Laura - 2020)</li>
                                    <li>Panama City (Hurricane Michael - 2018)</li>
                                </ul>
                            </div>
                        </div>

                        <div class="box mt-4">
                            <h3 class="title is-4">
                                <i class="fas fa-clipboard-list" style="color: var(--gs-cyan);"></i> Submission Log
                            </h3>
                            <div id="submissionLog" class="content" style="max-height: 400px; overflow-y: auto;">
                                {% if submissions %}
                                    {% for submission in submissions %}
                                    <div class="box mb-3" style="border-left: 4px solid {% if submission[3] == 'urgent' %}#f44336{% elif submission[3] == 'high' %}#ff9800{% else %}var(--gs-cyan){% endif %};">
                                        <p><strong>{{ submission[0] }}</strong> - {{ submission[4] }}</p>
                                        <p><span class="tag">{{ submission[1] }}</span> <span class="tag is-{% if submission[3] == 'urgent' %}danger{% elif submission[3] == 'high' %}warning{% else %}info{% endif %}">{{ submission[3] }}</span></p>
                                        <p>{{ submission[2] }}</p>
                                    </div>
                                    {% endfor %}
                                {% else %}
                                    <p style="color: #999;">No submissions yet. Be the first!</p>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>

                <div class="notification is-info is-light mt-5">
                    <p>
                        <strong>Pro tip:</strong> The best client ideas combine high property value + hurricane exposure + recent storm damage or new building codes.
                        Think luxury coastal properties that MUST upgrade their glass for insurance compliance.
                    </p>
                </div>
            </div>
        </div>
    </div>
</section>

<script>
    document.getElementById('ideaForm').addEventListener('submit', async function(e) {
        e.preventDefault();

        const formData = {
            name: document.getElementById('name').value,
            type: document.getElementById('ideaType').value,
            description: document.getElementById('description').value,
            priority: document.querySelector('input[name="priority"]:checked').value
        };

        try {
            // Save to database
            const response = await fetch('/collab', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(formData)
            });

            if (response.ok) {
                // Reload page to show new submission
                window.location.reload();
            } else {
                alert('Error saving submission. Please try again.');
            }
        } catch (error) {
            console.error('Error:', error);
            alert('Error saving submission. Please try again.');
        }
    });
</script>
{% endblock %}